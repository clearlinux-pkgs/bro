From 34d0cf886ca16c665f673a299e295b2a2bc14533 Mon Sep 17 00:00:00 2001
From: Jon Siwek <jsiwek@corelight.com>
Date: Mon, 10 Sep 2018 18:06:07 -0500
Subject: [PATCH] Fix potential memory leak in Kerberos scripts

Reported by Maksim Shudrak.

diff --git a/scripts/base/protocols/krb/main.bro b/scripts/base/protocols/krb/main.bro
index e45ce92cd5..076ea0e171 100644
--- a/scripts/base/protocols/krb/main.bro
+++ b/scripts/base/protocols/krb/main.bro
@@ -140,7 +140,8 @@ event krb_as_request(c: connection, msg: KDC_Request) &priority=5
 
 	c$krb$request_type = "AS";
 	c$krb$client       = fmt("%s/%s", msg?$client_name ? msg$client_name : "", msg$service_realm);
-	c$krb$service      = msg$service_name;
+	if ( msg?$service_name )
+		c$krb$service      = msg$service_name;
 
 	if ( msg?$from )
 		c$krb$from = msg$from;
@@ -183,7 +184,8 @@ event krb_tgs_request(c: connection, msg: KDC_Request) &priority=5
 		return;
 
 	c$krb$request_type = "TGS";
-	c$krb$service = msg$service_name;
+	if ( msg?$service_name )
+		c$krb$service = msg$service_name;
 	if ( msg?$from ) 
 		c$krb$from = msg$from;
 	c$krb$till = msg$till;
